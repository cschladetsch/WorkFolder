#!/bin/bash
# Common functions
#
# Remember to export functions at the end,
# if you wish them to be used outside of this script.

export WORK_VERBOSE=1

echo_verbose()
{
    if [ $WORK_VERBOSE -ge "$1" ]; then
        shift
        echo -e "$*"
    fi
}

function go()
{
    cur=$(pwd)
    repos_path="/w/repos/"
    repos=`find $repos_path -maxdepth 1 -type d`
    array=()
    print=1
    if [ -n "$1" ]; then
        print=0
    fi

    echo_verbose 3 "Go to repo:"
    count=0
    for var in $repos
    do
        cd "$var"
        if [ -d .git ]
        then
            array+=($var)
            name="`basename $var`"
            if [ $print -ge 1 ]; then
                if [ $var == $cur ]
                then
                    echo -e "\e[92m$count $name\e[0m"
                else
                    echo -e "$count $name"
                fi
            fi
            ((count++))
        fi
    done

    if [ $print -eq 1 ]; then
        read -rsn1 input
    else
        input=$1
    fi

    dest=${array[input]}
    echo_verbose 2 "â†’ $dest"

    cd "$dest"
}

gacp()
{
    if [ "$*" == "" ]; then
        echo "Need commit message"
        exit 1
    fi
    git add *
    git commit -m "$*"
    git push
}

unity_log()
{
    tail $* ~/AppData/Local/Unity/Editor/Editor.log
}

f()
{
    find . -name $*
}

help()
{
    start $WORK_DIR/doc/Readme.md
}

# Export functions
export gacp f help unity_log go

echo_verbose 2 "...functions"

